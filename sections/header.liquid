{%- comment -%}
  Modern Glassmorphism Header
  - Glassmorphism effect with backdrop blur
  - Sticky positioning
  - Clean menu styles (no backgrounds)
{%- endcomment -%}

{% liquid
  # Default order of header elements
  assign default_order = 'logo,menu,localization,search,mobile_search,actions'
  
  # Adjust order if customer accounts are enabled
  if shop.customer_accounts_enabled
    assign default_order = 'mobile_search,logo,menu,localization,search,actions'
  endif
  
  assign header_order = default_order
  
  # Determine search style
  assign search_style = 'none'
  if section.settings.show_search
    assign search_style = 'modal'
  endif
  
  # Capture header components
  capture logo
    content_for 'block', type: '_header-logo', id: 'header-logo'
  endcapture
  
  capture menu
    content_for 'block', type: '_header-menu', id: 'header-menu'
  endcapture
  
  capture mobile_menu
    content_for 'block', type: '_header-menu', id: 'header-menu', variant: 'mobile'
  endcapture
  
  capture navigation_bar
    content_for 'block', type: '_header-menu', id: 'header-menu', variant: 'navigation_bar'
  endcapture
  
  capture actions
    render 'header-actions'
  endcapture
  
  # Handle search positioning
  assign search_class = ''
  if shop.customer_accounts_enabled
    assign search_class = 'mobile:hidden'
  endif
  
  # Adjust order based on localization and search positions
  if section.settings.localization_position == 'left'
    if section.settings.search_position == 'left'
      if shop.customer_accounts_enabled
        assign header_order = 'mobile_search,logo,search,localization,menu,actions'
      else
        assign header_order = 'logo,search,localization,menu,mobile_search,actions'
      endif
    else
      if shop.customer_accounts_enabled
        assign header_order = 'mobile_search,logo,localization,menu,search,actions'
      else
        assign header_order = 'logo,localization,menu,search,mobile_search,actions'
      endif
    endif
  else
    if section.settings.search_position == 'left'
      if shop.customer_accounts_enabled
        assign header_order = 'mobile_search,logo,search,menu,localization,actions'
      else
        assign header_order = 'logo,search,menu,localization,mobile_search,actions'
      endif
    endif
  endif
  
  # Capture search component
  capture search
    render 'search', style: search_style, class: search_class
  endcapture
  
  # Handle mobile search
  assign skip_mobile_search = false
  if shop.customer_accounts_enabled == false and section.settings.search_position == 'left' and search_style != 'none'
    assign skip_mobile_search = true
  endif
  
  assign mobile_search = blank
  if section.settings.search_row == 'bottom' or search_style != 'none' and skip_mobile_search == false
    capture mobile_search
      render 'search', class: 'desktop:hidden', style: search_style
    endcapture
  endif
  
  # Handle localization
  assign show_language = section.settings.show_language
  if localization.available_languages.size <= 1
    assign show_language = false
  endif
  
  assign show_country = section.settings.show_country
  if localization.available_countries.size <= 1
    assign show_country = false
  endif
  
  assign localization_markup = blank
  if show_country or show_language
    capture localization_markup
      render 'dropdown-localization', 
        show_country: show_country, 
        show_language: show_language, 
        country_style: section.settings.country_selector_style, 
        localization_position: section.settings.localization_position
    endcapture
  endif
  
  # Determine bottom row blocks
  assign bottom_row_blocks = ''
  
  if section.settings.menu_row == 'bottom'
    assign bottom_row_blocks = bottom_row_blocks | append: 'menu,'
  endif
  
  if section.settings.search_style != 'none'
    if section.settings.search_row == 'bottom'
      assign bottom_row_blocks = bottom_row_blocks | append: 'search,'
    endif
  endif
  
  if section.settings.show_country or section.settings.show_language
    if section.settings.localization_row == 'bottom'
      assign bottom_row_blocks = bottom_row_blocks | append: 'localization,'
    endif
  endif
  
  assign bottom_row_blocks = bottom_row_blocks | split: ',' | compact
  
  # Header height class
  assign header_height_class = ''
  if section.settings.section_height == 'compact'
    assign header_height_class = ' header--compact'
  endif
  
  # Build header classes
  assign header_class = 'header header--glassmorphism'
  
  # Sticky header - always enabled
  assign sticky = 'always'
  
  assign rows = 'top,bottom' | split: ','
-%}

{%- comment -%} Schema.org structured data {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  {% if settings.logo %}
    "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
  {% endif %}
  "url": {{ request.origin | append: page.url | json }}
}
</script>

{%- comment -%} Main header component {%- endcomment -%}
<header-component
  id="header-component"
  class="{{ header_class }}"
  sticky="{{ sticky }}"
  data-skip-node-update
  data-scroll-direction="none"
>
  {%- if request.page_type == 'index' -%}
    <h1 class="visually-hidden">{{ shop.name }}</h1>
  {%- endif -%}
  
  {%- comment -%} Render header rows {%- endcomment -%}
  {% for row in rows %}
    {% liquid
      assign scheme = 'color_scheme_' | append: row
      assign row_class = 'header__row header__row--' | append: row | append: ' section section--full-width-margin section--page-width'
      
      case row
        when 'top'
          assign first = mobile_menu
          
          if bottom_row_blocks.size > 0 and section.settings.divider_size == 'page-width'
            assign row_class = row_class | append: ' divider--page-width'
          endif
          
          if bottom_row_blocks.size > 0
            assign border_bottom_setting_id = 'divider_width'
          else
            assign border_bottom_setting_id = 'border_width'
          endif
        when 'bottom'
          assign first = ''
          assign row_class = row_class | append: ' mobile:hidden'
          assign border_bottom_setting_id = 'border_width'
      endcase
      
      assign row_style = '--border-bottom-width: ' | append: section.settings[border_bottom_setting_id] | append: 'px; '
      
      if row == 'top'
        assign row_style = row_style | append: '--border-bottom-width-mobile: ' | append: section.settings.border_width | append: 'px; '
      endif
    %}
    
    {% capture row_content %}
      {% render 'header-row',
        row: row,
        order: header_order,
        settings: section.settings,
        first: first,
        logo: logo,
        menu: menu,
        actions: actions,
        localization: localization_markup,
        search: search,
        mobile_search: mobile_search
      %}
    {% endcapture %}
    
    {% assign row_content = row_content | strip %}
    {% if row_content != blank %}
      <div
        class="{{ row_class | strip }}"
        {% if row == 'top' %}ref="headerRowTop"{% endif %}
        {%- if row_style != blank -%}
          style="{{ row_style | strip }}"
        {%- endif -%}
      >
        <div class="header__columns spacing-style">
          {{ row_content }}
        </div>
      </div>
    {% endif %}
  {% endfor %}
  
  {%- comment -%} Mobile navigation bar {%- endcomment -%}
  {% if navigation_bar != blank %}
    <div class="header__row header__row--mobile desktop:hidden">
      {{ navigation_bar }}
    </div>
  {% endif %}
</header-component>

{%- comment -%} Header JavaScript {%- endcomment -%}
<script
  src="{{ 'header.js' | asset_url }}"
  type="module"
></script>

{%- comment -%} Modern Glassmorphism Header Styles {%- endcomment -%}
{% stylesheet %}
  /* Glassmorphism effect - OVERRIDE ALL OLD STYLES */
  #header-component.header--glassmorphism,
  header-component#header-component.header--glassmorphism {
    background: rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(12px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
    position: relative !important;
    width: 100% !important;
    overflow: visible !important;
  }

  /* Header row - apply glassmorphism effect */
  #header-component.header--glassmorphism .header__row,
  #header-component.header--glassmorphism .header__row--top,
  #header-component.header--glassmorphism .header__row--bottom {
    background: rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(12px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
    background-color: transparent !important;
    background-image: none !important;
  }

  /* Header columns - ensure layout works */
  #header-component.header--glassmorphism .header__columns {
    background: transparent !important;
    background-color: transparent !important;
  }

  #header-component.header--glassmorphism .header__column {
    background: transparent !important;
    background-color: transparent !important;
  }

  /* Sticky positioning */
  .header-section:has(> #header-component[sticky='always']),
  .header-section:has(> #header-component[sticky='scroll-up'][data-sticky-state='active']) {
    position: sticky !important;
    top: 0 !important;
    z-index: 9999 !important;
  }

  /* Clean menu styles - no backgrounds, just text */
  #header-component.header--glassmorphism .menu-list__link,
  #header-component.header--glassmorphism .menu-list__list-item,
  #header-component.header--glassmorphism .header__menu-item,
  #header-component.header--glassmorphism .menu-list__link-title {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    color: #1a1a1a !important;
    padding: var(--padding-xs) var(--padding-sm) !important;
    margin: 0 !important;
    border-radius: 0 !important;
    border: none !important;
    box-shadow: none !important;
    transition: color 0.3s ease !important;
  }

  #header-component.header--glassmorphism .menu-list__link:hover,
  #header-component.header--glassmorphism .menu-list__link:focus,
  #header-component.header--glassmorphism .menu-list__list-item:hover .menu-list__link {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    color: #1a1a1a !important;
    opacity: 0.7 !important;
    box-shadow: none !important;
  }

  /* Menu list spacing */
  #header-component.header--glassmorphism .menu-list__list {
    display: flex !important;
    gap: var(--gap-lg) !important;
    align-items: center !important;
  }

  /* Remove any button-like backgrounds from menu items */
  #header-component.header--glassmorphism .menu-list__list-item {
    background: none !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Remove backgrounds from actions and buttons */
  #header-component.header--glassmorphism .header-actions__action,
  #header-component.header--glassmorphism .search-action button,
  #header-component.header--glassmorphism .dropdown-localization__button {
    background-color: transparent !important;
    background: transparent !important;
    border: none !important;
  }

  /* Ensure header columns layout works properly */
  #header-component.header--glassmorphism .header__column {
    display: flex !important;
    align-items: center !important;
  }

  /* Menu in left column */
  #header-component.header--glassmorphism .header__column--left header-menu,
  #header-component.header--glassmorphism .header__column--left .menu-list {
    display: flex !important;
    align-items: center !important;
  }

  /* Logo in center column */
  #header-component.header--glassmorphism .header__column--center {
    justify-content: center !important;
  }

  /* Icons in right column */
  #header-component.header--glassmorphism .header__column--right {
    justify-content: flex-end !important;
    gap: var(--gap-md) !important;
  }
{% endstylesheet %}

{% unless request.design_mode %}
  <script type="module">
    import { hydrate } from '@theme/section-hydration';
    const url = new URL(window.location.href);
    url.searchParams.delete('page');
    hydrate('{{ section.id }}', url);
  </script>
{% endunless %}

{% schema %}
{
  "name": "t:names.header",
  "tag": "header",
  "class": "header-section",
  "settings": [
    {
      "type": "header",
      "content": "t:content.logo"
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "t:settings.position",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:content.menu"
    },
    {
      "type": "select",
      "id": "menu_position",
      "label": "t:settings.position",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "menu_row",
      "label": "t:settings.row",
      "options": [
        {
          "value": "top",
          "label": "t:options.top"
        },
        {
          "value": "bottom",
          "label": "t:options.bottom"
        }
      ],
      "default": "top"
    },
    {
      "type": "header",
      "content": "t:content.search"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "t:settings.search_icon",
      "default": true
    },
    {
      "type": "select",
      "id": "search_position",
      "label": "t:settings.search_position",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "right",
      "visible_if": "{{ section.settings.show_search }}"
    },
    {
      "type": "select",
      "id": "search_row",
      "label": "t:settings.search_row",
      "options": [
        {
          "value": "top",
          "label": "t:options.top"
        },
        {
          "value": "bottom",
          "label": "t:options.bottom"
        }
      ],
      "default": "top",
      "visible_if": "{{ section.settings.show_search }}"
    },
    {
      "type": "header",
      "content": "t:content.localization"
    },
    {
      "type": "checkbox",
      "id": "show_country",
      "label": "t:settings.country_region",
      "info": "t:info.manage_countries_regions",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "country_selector_style",
      "label": "t:settings.flag",
      "default": true,
      "visible_if": "{{ section.settings.show_country }}"
    },
    {
      "type": "checkbox",
      "id": "show_language",
      "label": "t:settings.language_selector",
      "info": "t:info.manage_languages",
      "default": true
    },
    {
      "type": "select",
      "id": "localization_position",
      "label": "t:settings.position",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "right",
      "visible_if": "{{ section.settings.show_country or section.settings.show_language }}"
    },
    {
      "type": "select",
      "id": "localization_row",
      "label": "t:settings.row",
      "options": [
        {
          "value": "top",
          "label": "t:options.top"
        },
        {
          "value": "bottom",
          "label": "t:options.bottom"
        }
      ],
      "default": "top",
      "visible_if": "{{ section.settings.show_country or section.settings.show_language }}"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "t:settings.border_width",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "divider_width",
      "label": "t:settings.divider_thickness",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "default": 0,
      "visible_if": "{{ section.settings.menu_row == 'bottom' or section.settings.localization_row == 'bottom' or section.settings.search_row == 'bottom' }}"
    },
    {
      "type": "select",
      "id": "divider_size",
      "label": "t:settings.divider_width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "visible_if": "{{ section.settings.divider_width > 0 and section.settings.menu_row == 'bottom' or section.settings.localization_row == 'bottom' or section.settings.search_row == 'bottom' }}"
    },
    {
      "type": "select",
      "id": "section_height",
      "label": "t:settings.height",
      "options": [
        {
          "value": "compact",
          "label": "t:options.compact"
        },
        {
          "value": "standard",
          "label": "t:options.standard"
        }
      ],
      "default": "standard"
    }
  ],
  "presets": []
}
{% endschema %}
